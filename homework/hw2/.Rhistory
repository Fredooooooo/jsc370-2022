mutate(gasstove=round(gasstove)) %>%
mutate(obesity_level=case_when(
bmi < 14 ~ "underweight",
14 <= bmi & bmi < 22 ~ "normal",
22 <= bmi & bmi <= 24 ~ "overweight",
bmi > 24 ~ "obese"))
df %>% group_by(obesity_level) %>% summarise(min_BMI = min(bmi), max_BMI = max(bmi), count = n())
df <- df %>% mutate(smoke_gas_exposure = as.factor(interaction(smoke, gasstove)))
df %>% group_by(townname) %>% summarise(Mean_of_FEV = mean(fev), Sd_of_FEV = sqrt(var(fev)), Mean_of_asthma = mean(asthma), Sd_of_asthma = sqrt(var(asthma)))
df %>% group_by(male) %>% summarise(Mean_of_FEV = mean(fev), Sd_of_FEV = sqrt(var(fev)), Mean_of_asthma = mean(asthma), Sd_of_asthma = sqrt(var(asthma)))
df %>% group_by(obesity_level) %>% summarise(Mean_of_FEV = mean(fev), Sd_of_FEV = sqrt(var(fev)), Mean_of_asthma = mean(asthma), Sd_of_asthma = sqrt(var(asthma)))
df %>% group_by(smoke_gas_exposure) %>% summarise(Mean_of_FEV = mean(fev), Sd_of_FEV = sqrt(var(fev)), Mean_of_asthma = mean(asthma), Sd_of_asthma = sqrt(var(asthma)))
dim(df)
head(df)
tail(df)
summary(df$bmi)
boxplot(df$bmi)
summary(df$fev)
boxplot(df$fev)
df %>% group_by(smoke_gas_exposure) %>% summarise(count = n())
summary(df$pm25_mass)
boxplot(df$pm25_mass)
df %>% ggplot(aes(x = bmi, y = fev)) + geom_point() + geom_smooth(method='lm', formula= y~x) + ggtitle("Scatterplot of BMI vs. FEV") + xlab("BMI") + ylab("Forced expiratory volume in 1 second (ml)") + facet_wrap(df$townname)
View(df)
df %>% ggplot(aes(x=fev,fill = obesity_level)) + geom_histogram() + scale_fill_manual(values = c("#78BC61", "#E03400", "#520048")) + theme_minimal() + labs(caption = "Created by You Peng in STA303/1002, Winter 2022")
df %>% ggplot(aes(x=fev,fill = obesity_level)) + geom_histogram() + scale_fill_manual(values = c("yellow", "red", "blue", "purple")) + theme_minimal() + labs(caption = "Created by You Peng in STA303/1002, Winter 2022")
df %>% ggplot(aes(x=fev,fill = obesity_level)) + geom_histogram() + scale_fill_manual(values = c("yellow", "red", "blue", "green")) + theme_minimal() + labs(caption = "Created by You Peng in STA303/1002, Winter 2022")
df %>% ggplot(aes(x=fev,fill = obesity_level)) + geom_histogram() + scale_fill_manual(values = c("yellow", "red", "blue", "#78BC61")) + theme_minimal() + labs(caption = "Created by You Peng in STA303/1002, Winter 2022")
df %>% ggplot(aes(x=fev,fill = smoke_gas_exposure)) + geom_histogram() + scale_fill_manual(values = c("yellow", "red", "blue", "#78BC61")) + theme_minimal() + labs(title = "Stacked histogram of FEV by smoke/gas exposure")
#install.packages(c("data.table","leaflet", "rdrop2"))
library(data.table)
library(leaflet)
library(tidyverse)
library(rdrop2)
library(GGally)
library(scales)
individual <- read.csv("chs_individual.csv")
regional <- read.csv("chs_regional_geo.csv")
df <- merge.data.frame(individual, regional, "townname")
df <- df %>% group_by(male, hispanic) %>%
mutate_all(list(~ifelse(is.na(.), mean(., na.rm = TRUE),.)))
df <- df %>%
mutate(townname=as.factor(townname)) %>%
mutate(asthma=round(asthma)) %>%
mutate(father_asthma=round(father_asthma)) %>%
mutate(mother_asthma=round(mother_asthma)) %>%
mutate(wheeze=round(wheeze)) %>%
mutate(hayfever=round(hayfever)) %>%
mutate(allergy=round(allergy)) %>%
mutate(educ_parent=round(educ_parent)) %>%
mutate(smoke=round(smoke)) %>%
mutate(gasstove=round(gasstove)) %>%
mutate(obesity_level=case_when(
bmi < 14 ~ "underweight",
14 <= bmi & bmi < 22 ~ "normal",
22 <= bmi & bmi <= 24 ~ "overweight",
bmi > 24 ~ "obese"))
df %>% group_by(obesity_level) %>% summarise(min_BMI = min(bmi), max_BMI = max(bmi), count = n())
df <- df %>% mutate(smoke_gas_exposure = as.factor(interaction(smoke, gasstove)))
df %>% group_by(townname) %>% summarise(Mean_of_FEV = mean(fev), Sd_of_FEV = sqrt(var(fev)), Mean_of_asthma = mean(asthma), Sd_of_asthma = sqrt(var(asthma)))
df %>% group_by(male) %>% summarise(Mean_of_FEV = mean(fev), Sd_of_FEV = sqrt(var(fev)), Mean_of_asthma = mean(asthma), Sd_of_asthma = sqrt(var(asthma)))
df %>% group_by(obesity_level) %>% summarise(Mean_of_FEV = mean(fev), Sd_of_FEV = sqrt(var(fev)), Mean_of_asthma = mean(asthma), Sd_of_asthma = sqrt(var(asthma)))
df %>% group_by(smoke_gas_exposure) %>% summarise(Mean_of_FEV = mean(fev), Sd_of_FEV = sqrt(var(fev)), Mean_of_asthma = mean(asthma), Sd_of_asthma = sqrt(var(asthma)))
dim(df)
head(df)
tail(df)
summary(df$bmi)
boxplot(df$bmi)
summary(df$fev)
boxplot(df$fev)
df %>% group_by(smoke_gas_exposure) %>% summarise(count = n())
summary(df$pm25_mass)
boxplot(df$pm25_mass)
df %>% ggplot(aes(x = bmi, y = fev)) + geom_point() + geom_smooth(method='lm', formula= y~x) + ggtitle("Scatterplot of BMI vs. FEV") + xlab("BMI") + ylab("Forced expiratory volume in 1 second (ml)") + facet_wrap(df$townname)
df %>% ggplot(aes(x=fev,fill = obesity_level)) + geom_histogram() + scale_fill_manual(values = c("yellow", "red", "blue", "#78BC61")) + theme_minimal() + labs(title = "Stacked histogram of FEV by BMI category")
df %>% ggplot(aes(x=fev,fill = smoke_gas_exposure)) + geom_histogram() + scale_fill_manual(values = c("yellow", "red", "blue", "#78BC61")) + theme_minimal() + labs(title = "Stacked histogram of FEV by smoke/gas exposure")
df %>% ggplot(aes(x=smoke_gas_exposure,y = bmi)) + geom_bar() + theme_minimal() + labs(title = "Barchart of BMI by smoke/gas exposure")
df %>% ggplot(aes(x=smoke_gas_exposure,y = bmi)) + geom_col() + theme_minimal() + labs(title = "Barchart of BMI by smoke/gas exposure")
library(data.table)
library(leaflet)
library(tidyverse)
fn <- "https://raw.githubusercontent.com/JSC370/jsc370-2022/main/labs/lab03/met_all.gz"
if (!file.exists("met_all.gz"))
download.file(fn, destfile = "met_all.gz")
met <- data.table::fread("met_all.gz")
# Remove temperatures less than -17C
met %>% filter(temp>=-17) %>%
# Make sure there are no missing data in the key variables coded as 9999, 999, etc
na_if(9999) %>%
#  Generate a date variable using the functions `as.Date()` (hint: You will need the following to create a date `paste(year, month, day, sep = "-")`).
mutate(date=as.Date(paste(year, month, day, sep="-"))) %>%
# Using the `data.table::week` function, keep the observations of the first week of the month.
mutate(week=data.table::week(date)) %>%
filter(week==min(week)) %>%
# Compute the mean by station of the variables `temp`, `rh`, `wind.sp`, `vis.dist`, `dew.point`, `lat`,`lon`, and `elev`.
group_by(USAFID) %>%
summarise(temp=mean(temp, na.rm = T),
rh=mean(rh, na.rm = T),
wind.sp=mean(wind.sp, na.rm = T),
vis.dist=mean(vis.dist, na.rm = T),
dew.point=mean(dew.point, na.rm = T),
lat=mean(lat), lon=mean(lon),
elev=mean(elev, na.rm = T)) %>%
# Create a region variable for NW, SW, NE, SE based on lon = -98.00 and lat = 39.71 degrees
mutate(region = ifelse(lat > 39.71, "north", "south")) %>%
mutate(region = paste(region, ifelse(lon > -98, "east", "west"))) %>%
# Create a categorical variable for elevation (breakpoint 252 m)
mutate(elev_cat=ifelse(elev>252, "high", "low")) -> met_avg
met_avg %>% filter(! (region %in% NA)) %>% ggplot() + aes(x=1, y=wind.sp, fill=region) + geom_violin() + facet_wrap(~region)
met_avg %>% filter(! (region %in% NA)) %>% ggplot() + aes(x=1, y=dew.point, fill=region) + geom_violin() + facet_wrap(~region)
met_avg %>% filter(! (region %in% NA)) %>% ggplot() + aes(x=dew.point, y=wind.sp, color=region) + geom_jitter() +
# fit linear regression
stat_smooth(method=lm)
met_avg %>% filter(! (region %in% NA)) %>% ggplot() + aes(x=elev_cat, fill=region) + geom_bar(position = "dodge") + scale_fill_brewer(palette = "PuOr") + theme_minimal() + labs(title="Num of weather stations by elevation category and region", x="Elevation Category", y="count")
met_avg %>% filter(! (region %in% NA)) %>% ggplot() + aes(x=region, y=dew.point) + stat_summary(fun.data = "mean_sdl", geom = "errorbar") + stat_summary(fun.data = "mean_sdl")
met_avg %>% filter(! (region %in% NA)) %>% ggplot() + aes(x=region, y=wind.sp) + stat_summary(fun.data = "mean_sdl", geom = "errorbar") + stat_summary(fun.data = "mean_sdl")
top10 <- met_avg %>% arrange(desc(rh)) %>% slice_head(n=10)
rh_pal <- colorNumeric(c('blue', 'yellow', 'red'), domain = met_avg$rh, na.color = NA)
met_avg %>% drop_na() %>% leaflet() %>% addProviderTiles('OpenStreetMap') %>% addCircles(lat = ~lat, lng = ~lon, color=~rh_pal(rh), label=~paste(round(rh,2), 'rh'), opacity = 1, fillOpacity = 1, radius=~elev*10) %>% addMarkers(lat = ~lat, lng = ~lon, label = ~paste(round(rh,2), 'rh'), data = top10) %>% addLegend('bottomleft', pal = rh_pal, values=met_avg$rh, title="relative humidity", opacity=1)
library(ggtech)
# download.file("https://www.etsy.com/assets/type/Guardian-EgypTT-Text-Regular.ttf", "C:/Windows/Fonts/Guardian-EgypTT-Text-Regular.ttf", method="curl")
# extrafont::font_import(pattern = 'Guardian-EgypTT-Text-Regular.ttf', prompt=FALSE)
d <- qplot(temp, data = met_avg[met_avg$region %in%LETTERS[4:7], ], geom = "histogram", bins=30, fill = region)
d + theme_tech(theme="etsy") +
scale_fill_tech(theme="etsy") +
labs(title="Temperature")
library(ggthemes)
p <- met_avg %>% ggplot(aes(x=wind.sp, y=temp)) + geom_point() + stat_smooth(method=lm, color="red") + theme_economist() + scale_colour_economist() + ggtitle('temperature and wind speed are positively correlated')
p
df %>% ggplot() + aes(x=bmi, fill=smoke_gas_exposure) + geom_bar(position = "dodge") + scale_fill_brewer(palette = "PuOr") + theme_minimal() + labs(title="Barchart of BMI by smoke/gas exposure", x="BMI", y="count")
#install.packages(c("data.table","leaflet", "rdrop2"))
library(data.table)
library(leaflet)
library(tidyverse)
library(rdrop2)
library(GGally)
library(scales)
individual <- read.csv("chs_individual.csv")
regional <- read.csv("chs_regional_geo.csv")
df <- merge.data.frame(individual, regional, "townname")
df <- df %>% group_by(male, hispanic) %>%
mutate_all(list(~ifelse(is.na(.), mean(., na.rm = TRUE),.)))
df <- df %>%
mutate(townname=as.factor(townname)) %>%
mutate(asthma=round(asthma)) %>%
mutate(father_asthma=round(father_asthma)) %>%
mutate(mother_asthma=round(mother_asthma)) %>%
mutate(wheeze=round(wheeze)) %>%
mutate(hayfever=round(hayfever)) %>%
mutate(allergy=round(allergy)) %>%
mutate(educ_parent=round(educ_parent)) %>%
mutate(smoke=round(smoke)) %>%
mutate(gasstove=round(gasstove)) %>%
mutate(obesity_level=case_when(
bmi < 14 ~ "underweight",
14 <= bmi & bmi < 22 ~ "normal",
22 <= bmi & bmi <= 24 ~ "overweight",
bmi > 24 ~ "obese"))
df %>% group_by(obesity_level) %>% summarise(min_BMI = min(bmi), max_BMI = max(bmi), count = n())
df <- df %>% mutate(smoke_gas_exposure = as.factor(interaction(smoke, gasstove)))
df %>% group_by(townname) %>% summarise(Mean_of_FEV = mean(fev), Sd_of_FEV = sqrt(var(fev)), Mean_of_asthma = mean(asthma), Sd_of_asthma = sqrt(var(asthma)))
df %>% group_by(male) %>% summarise(Mean_of_FEV = mean(fev), Sd_of_FEV = sqrt(var(fev)), Mean_of_asthma = mean(asthma), Sd_of_asthma = sqrt(var(asthma)))
df %>% group_by(obesity_level) %>% summarise(Mean_of_FEV = mean(fev), Sd_of_FEV = sqrt(var(fev)), Mean_of_asthma = mean(asthma), Sd_of_asthma = sqrt(var(asthma)))
df %>% group_by(smoke_gas_exposure) %>% summarise(Mean_of_FEV = mean(fev), Sd_of_FEV = sqrt(var(fev)), Mean_of_asthma = mean(asthma), Sd_of_asthma = sqrt(var(asthma)))
dim(df)
head(df)
tail(df)
summary(df$bmi)
boxplot(df$bmi)
summary(df$fev)
boxplot(df$fev)
df %>% group_by(smoke_gas_exposure) %>% summarise(count = n())
summary(df$pm25_mass)
boxplot(df$pm25_mass)
df %>% ggplot(aes(x = bmi, y = fev)) + geom_point() + geom_smooth(method='lm', formula= y~x) + ggtitle("Scatterplot of BMI vs. FEV") + xlab("BMI") + ylab("Forced expiratory volume in 1 second (ml)") + facet_wrap(df$townname)
df %>% ggplot(aes(x=fev,fill = obesity_level)) + geom_histogram() + scale_fill_manual(values = c("yellow", "red", "blue", "#78BC61")) + theme_minimal() + labs(title = "Stacked histogram of FEV by BMI category")
df %>% ggplot(aes(x=fev,fill = smoke_gas_exposure)) + geom_histogram() + scale_fill_manual(values = c("yellow", "red", "blue", "#78BC61")) + theme_minimal() + labs(title = "Stacked histogram of FEV by smoke/gas exposure")
df %>% ggplot(aes(x=smoke_gas_exposure,y = bmi)) + geom_col() + theme_minimal() + labs(title = "Barchart of BMI by smoke/gas exposure")
df %>% ggplot() + aes(x=bmi, fill=smoke_gas_exposure) + geom_bar(position = "dodge") + scale_fill_brewer(palette = "PuOr") + theme_minimal() + labs(title="Barchart of BMI by smoke/gas exposure", x="BMI", y="count")
df %>% ggplot(aes(x=smoke_gas_exposure,y = bmi)) + geom_col() + theme_minimal() + labs(title = "Barchart of BMI by smoke/gas exposure")
df %>% ggplot() + aes(x=bmi, fill=smoke_gas_exposure) + geom_bar() + scale_fill_brewer(palette = "PuOr") + theme_minimal() + labs(title="Barchart of BMI by smoke/gas exposure", x="BMI", y="count")
df %>% ggplot() + aes(x=bmi, fill=smoke_gas_exposure) + geom_bar(position = "dodge") + theme_minimal() + labs(title="Barchart of BMI by smoke/gas exposure", x="BMI", y="count")
df %>% ggplot() + aes(x=bmi, fill=smoke_gas_exposure) + geom_bar() + theme_minimal() + labs(title="Barchart of BMI by smoke/gas exposure", x="BMI", y="count")
df %>% ggplot() + aes(x=obesity_level, fill=smoke_gas_exposure) + geom_bar(position = "dodge") + scale_fill_brewer(palette = "PuOr") + theme_minimal() + labs(title="Barchart of BMI by smoke/gas exposure", x="BMI", y="count")
df %>% ggplot() + aes(x=obesity_level, y=fev) + stat_summary(fun.data = "mean_sdl", geom = "errorbar") + stat_summary(fun.data = "mean_sdl")
df %>% ggplot() + aes(x=smoke_gas_exposure, y=fev) + stat_summary(fun.data = "mean_sdl", geom = "errorbar") + stat_summary(fun.data = "mean_sdl")
top10 <- met_avg %>% arrange(desc(rh)) %>% slice_head(n=10)
pm_pal <- colorNumeric(c('blue', 'yellow', 'red'), domain = df$pm25_mass, na.color = NA)
df %>% drop_na() %>% leaflet() %>% addProviderTiles('OpenStreetMap') %>% addCircles(lat = ~lat, lng = ~lon, color=~pm_pal(pm25_mass), label=~round(pm25_mass,2), opacity = 1, fillOpacity = 1) %>% addLegend('bottomleft', pal = pm_pal, values=df$pm25_mass, title="relative humidity", opacity=1)
top10 <- met_avg %>% arrange(desc(rh)) %>% slice_head(n=10)
pm_pal <- colorNumeric(c('blue', 'yellow', 'red'), domain = df$pm25_mass, na.color = NA)
df %>% drop_na() %>% leaflet() %>% addProviderTiles('OpenStreetMap') %>% addCircles(lat = ~lat, lng = ~lon, color=~pm_pal(pm25_mass), label=~round(pm25_mass,2), opacity = 1, fillOpacity = 1) %>% addLegend('bottomleft', pal = pm_pal, values=df$pm25_mass, title="pm2.5 concentration", opacity=1)
df %>% ggplot(aes(x = fev, y = pm25_mass)) + geom_point() + geom_smooth(method='lm', formula= y~x) + ggtitle("Scatterplot of FEV vs. PM2.5 concentration") + xlab("forced expiratory volume") + ylab("pm2.5 concentration")
#install.packages(c("data.table","leaflet", "rdrop2"))
library(data.table)
library(leaflet)
library(tidyverse)
library(rdrop2)
library(GGally)
library(scales)
individual <- read.csv("chs_individual.csv")
regional <- read.csv("chs_regional_geo.csv")
df <- merge.data.frame(individual, regional, "townname")
df <- df %>% group_by(male, hispanic) %>%
mutate_all(list(~ifelse(is.na(.), mean(., na.rm = TRUE),.)))
df <- df %>%
mutate(townname=as.factor(townname)) %>%
mutate(asthma=round(asthma)) %>%
mutate(father_asthma=round(father_asthma)) %>%
mutate(mother_asthma=round(mother_asthma)) %>%
mutate(wheeze=round(wheeze)) %>%
mutate(hayfever=round(hayfever)) %>%
mutate(allergy=round(allergy)) %>%
mutate(educ_parent=round(educ_parent)) %>%
mutate(smoke=round(smoke)) %>%
mutate(gasstove=round(gasstove)) %>%
mutate(obesity_level=case_when(
bmi < 14 ~ "underweight",
14 <= bmi & bmi < 22 ~ "normal",
22 <= bmi & bmi <= 24 ~ "overweight",
bmi > 24 ~ "obese"))
df %>% group_by(obesity_level) %>% summarise(min_BMI = min(bmi), max_BMI = max(bmi), count = n())
df <- df %>% mutate(smoke_gas_exposure = as.factor(interaction(smoke, gasstove)))
df %>% group_by(townname) %>% summarise(Mean_of_FEV = mean(fev), Sd_of_FEV = sqrt(var(fev)), Mean_of_asthma = mean(asthma), Sd_of_asthma = sqrt(var(asthma)))
df %>% group_by(male) %>% summarise(Mean_of_FEV = mean(fev), Sd_of_FEV = sqrt(var(fev)), Mean_of_asthma = mean(asthma), Sd_of_asthma = sqrt(var(asthma)))
df %>% group_by(obesity_level) %>% summarise(Mean_of_FEV = mean(fev), Sd_of_FEV = sqrt(var(fev)), Mean_of_asthma = mean(asthma), Sd_of_asthma = sqrt(var(asthma)))
df %>% group_by(smoke_gas_exposure) %>% summarise(Mean_of_FEV = mean(fev), Sd_of_FEV = sqrt(var(fev)), Mean_of_asthma = mean(asthma), Sd_of_asthma = sqrt(var(asthma)))
dim(df)
head(df)
tail(df)
summary(df$bmi)
boxplot(df$bmi)
summary(df$fev)
boxplot(df$fev)
df %>% group_by(smoke_gas_exposure) %>% summarise(count = n())
summary(df$pm25_mass)
boxplot(df$pm25_mass)
df %>% ggplot(aes(x = bmi, y = fev)) + geom_point() + geom_smooth(method='lm', formula= y~x) + ggtitle("Scatterplot of BMI vs. FEV") + xlab("BMI") + ylab("Forced expiratory volume in 1 second (ml)") + facet_wrap(df$townname)
df %>% ggplot(aes(x=fev,fill = obesity_level)) + geom_histogram() + scale_fill_manual(values = c("yellow", "red", "blue", "#78BC61")) + theme_minimal() + labs(title = "Stacked histogram of FEV by BMI category")
df %>% ggplot(aes(x=fev,fill = smoke_gas_exposure)) + geom_histogram() + scale_fill_manual(values = c("yellow", "red", "blue", "#78BC61")) + theme_minimal() + labs(title = "Stacked histogram of FEV by smoke/gas exposure")
df %>% ggplot() + aes(x=obesity_level, fill=smoke_gas_exposure) + geom_bar(position = "dodge") + scale_fill_brewer(palette = "PuOr") + theme_minimal() + labs(title="Barchart of BMI by smoke/gas exposure", x="BMI", y="count")
df %>% ggplot() + aes(x=obesity_level, y=fev) + stat_summary(fun.data = "mean_sdl", geom = "errorbar") + stat_summary(fun.data = "mean_sdl")
df %>% ggplot() + aes(x=smoke_gas_exposure, y=fev) + stat_summary(fun.data = "mean_sdl", geom = "errorbar") + stat_summary(fun.data = "mean_sdl")
pm_pal <- colorNumeric(c('blue', 'yellow', 'red'), domain = df$pm25_mass, na.color = NA)
df %>% drop_na() %>% leaflet() %>% addProviderTiles('OpenStreetMap') %>% addCircles(lat = ~lat, lng = ~lon, color=~pm_pal(pm25_mass), label=~round(pm25_mass,2), opacity = 1, fillOpacity = 1) %>% addLegend('bottomleft', pal = pm_pal, values=df$pm25_mass, title="pm2.5 concentration", opacity=1)
df %>% ggplot(aes(x = fev, y = pm25_mass)) + geom_point() + geom_smooth(method='lm', formula= y~x) + ggtitle("Scatterplot of FEV vs. PM2.5 concentration") + xlab("forced expiratory volume") + ylab("pm2.5 concentration")
df %>% ggplot(aes(x=pm25_mass, y=fev)) + geom_boxplot() + ggtitle("Boxplot of FEV with different PM2.5 concentration") + xlab("pm2.5 concentration") + ylab("forced expiratory volume")
df %>% ggplot(aes(x=as.factor(pm25_mass), y=fev)) + geom_boxplot() + ggtitle("Boxplot of FEV with different PM2.5 concentration") + xlab("pm2.5 concentration") + ylab("forced expiratory volume")
#install.packages(c("data.table","leaflet", "rdrop2"))
library(data.table)
library(leaflet)
library(tidyverse)
library(rdrop2)
library(GGally)
library(scales)
individual <- read.csv("chs_individual.csv")
regional <- read.csv("chs_regional_geo.csv")
df <- merge.data.frame(individual, regional, "townname")
df <- df %>% group_by(male, hispanic) %>%
mutate_all(list(~ifelse(is.na(.), mean(., na.rm = TRUE),.)))
df <- df %>%
mutate(townname=as.factor(townname)) %>%
mutate(asthma=round(asthma)) %>%
mutate(father_asthma=round(father_asthma)) %>%
mutate(mother_asthma=round(mother_asthma)) %>%
mutate(wheeze=round(wheeze)) %>%
mutate(hayfever=round(hayfever)) %>%
mutate(allergy=round(allergy)) %>%
mutate(educ_parent=round(educ_parent)) %>%
mutate(smoke=round(smoke)) %>%
mutate(gasstove=round(gasstove)) %>%
mutate(obesity_level=case_when(
bmi < 14 ~ "underweight",
14 <= bmi & bmi < 22 ~ "normal",
22 <= bmi & bmi <= 24 ~ "overweight",
bmi > 24 ~ "obese"))
df %>% group_by(obesity_level) %>% summarise(min_BMI = min(bmi), max_BMI = max(bmi), count = n())
df <- df %>% mutate(smoke_gas_exposure = as.factor(interaction(smoke, gasstove)))
df %>% group_by(townname) %>% summarise(Mean_of_FEV = mean(fev), Sd_of_FEV = sqrt(var(fev)), Mean_of_asthma = mean(asthma), Sd_of_asthma = sqrt(var(asthma)))
df %>% group_by(male) %>% summarise(Mean_of_FEV = mean(fev), Sd_of_FEV = sqrt(var(fev)), Mean_of_asthma = mean(asthma), Sd_of_asthma = sqrt(var(asthma)))
df %>% group_by(obesity_level) %>% summarise(Mean_of_FEV = mean(fev), Sd_of_FEV = sqrt(var(fev)), Mean_of_asthma = mean(asthma), Sd_of_asthma = sqrt(var(asthma)))
df %>% group_by(smoke_gas_exposure) %>% summarise(Mean_of_FEV = mean(fev), Sd_of_FEV = sqrt(var(fev)), Mean_of_asthma = mean(asthma), Sd_of_asthma = sqrt(var(asthma)))
dim(df)
head(df)
tail(df)
summary(df$bmi)
boxplot(df$bmi)
summary(df$fev)
boxplot(df$fev)
df %>% group_by(smoke_gas_exposure) %>% summarise(count = n())
summary(df$pm25_mass)
boxplot(df$pm25_mass)
df %>% ggplot(aes(x = bmi, y = fev)) + geom_point() + geom_smooth(method='lm', formula= y~x) + ggtitle("Scatterplot of BMI vs. FEV") + xlab("BMI") + ylab("Forced expiratory volume in 1 second (ml)") + facet_wrap(df$townname)
df %>% ggplot(aes(x=fev,fill = obesity_level)) + geom_histogram() + scale_fill_manual(values = c("yellow", "red", "blue", "#78BC61")) + theme_minimal() + labs(title = "Stacked histogram of FEV by BMI category")
df %>% ggplot(aes(x=fev,fill = smoke_gas_exposure)) + geom_histogram() + scale_fill_manual(values = c("yellow", "red", "blue", "#78BC61")) + theme_minimal() + labs(title = "Stacked histogram of FEV by smoke/gas exposure")
df %>% ggplot() + aes(x=obesity_level, fill=smoke_gas_exposure) + geom_bar(position = "dodge") + scale_fill_brewer(palette = "PuOr") + theme_minimal() + labs(title="Barchart of BMI by smoke/gas exposure", x="BMI", y="count")
df %>% ggplot() + aes(x=obesity_level, y=fev) + stat_summary(fun.data = "mean_sdl", geom = "errorbar") + stat_summary(fun.data = "mean_sdl")
df %>% ggplot() + aes(x=smoke_gas_exposure, y=fev) + stat_summary(fun.data = "mean_sdl", geom = "errorbar") + stat_summary(fun.data = "mean_sdl")
pm_pal <- colorNumeric(c('blue', 'yellow', 'red'), domain = df$pm25_mass, na.color = NA)
df %>% drop_na() %>% leaflet() %>% addProviderTiles('OpenStreetMap') %>% addCircles(lat = ~lat, lng = ~lon, color=~pm_pal(pm25_mass), label=~round(pm25_mass,2), opacity = 1, fillOpacity = 1) %>% addLegend('bottomleft', pal = pm_pal, values=df$pm25_mass, title="pm2.5 concentration", opacity=1)
df %>% ggplot(aes(x = fev, y = pm25_mass)) + geom_point() + geom_smooth(method='lm', formula= y~x) + ggtitle("Scatterplot of FEV vs. PM2.5 concentration") + xlab("forced expiratory volume") + ylab("pm2.5 concentration")
df %>% ggplot(aes(x=as.factor(pm25_mass), y=fev)) + geom_boxplot() + ggtitle("Boxplot of FEV with different PM2.5 concentration") + xlab("pm2.5 concentration") + ylab("forced expiratory volume")
ggplot(df, aes(x=weight, y=fev)) + geom_point() + geom_smooth(method="lm") + geom_smooth(method = "gam", col=2)
library(mgcv)
lm_mod <- lm(fev ~ weight, data=df)
summary(lm_mod)
plot(lm_mod)
gam_mod <- gam(fev ~ s(weight, bs="cr", k=20), data=df)
summary(gam_mod)
ggplot(df, aes(x=weight, y=fev)) + geom_point() + geom_smooth(method="lm") + geom_smooth(method = "gam", col=2)
library(mgcv)
lm_mod <- lm(fev ~ weight+agepft+male+as.factor(race), data=df)
summary(lm_mod)
gam_mod <- gam(fev ~ s(weight, bs="cr", k=20)+agepft+male+as.factor(race), data=df)
summary(gam_mod)
#install.packages(c("data.table","leaflet", "rdrop2"))
library(data.table)
library(leaflet)
library(tidyverse)
library(rdrop2)
library(GGally)
library(scales)
individual <- read.csv("chs_individual.csv")
regional <- read.csv("chs_regional_geo.csv")
df <- merge.data.frame(individual, regional, "townname")
df <- df %>% group_by(male, hispanic) %>%
mutate_all(list(~ifelse(is.na(.), mean(., na.rm = TRUE),.)))
df <- df %>%
mutate(townname=as.factor(townname)) %>%
mutate(asthma=round(asthma)) %>%
mutate(father_asthma=round(father_asthma)) %>%
mutate(mother_asthma=round(mother_asthma)) %>%
mutate(wheeze=round(wheeze)) %>%
mutate(hayfever=round(hayfever)) %>%
mutate(allergy=round(allergy)) %>%
mutate(educ_parent=round(educ_parent)) %>%
mutate(smoke=round(smoke)) %>%
mutate(gasstove=round(gasstove)) %>%
mutate(obesity_level=case_when(
bmi < 14 ~ "underweight",
14 <= bmi & bmi < 22 ~ "normal",
22 <= bmi & bmi <= 24 ~ "overweight",
bmi > 24 ~ "obese"))
df %>% group_by(obesity_level) %>% summarise(min_BMI = min(bmi), max_BMI = max(bmi), count = n())
df <- df %>% mutate(smoke_gas_exposure = as.factor(interaction(smoke, gasstove)))
df %>% group_by(townname) %>% summarise(Mean_of_FEV = mean(fev), Sd_of_FEV = sqrt(var(fev)), Mean_of_asthma = mean(asthma), Sd_of_asthma = sqrt(var(asthma)))
df %>% group_by(male) %>% summarise(Mean_of_FEV = mean(fev), Sd_of_FEV = sqrt(var(fev)), Mean_of_asthma = mean(asthma), Sd_of_asthma = sqrt(var(asthma)))
df %>% group_by(obesity_level) %>% summarise(Mean_of_FEV = mean(fev), Sd_of_FEV = sqrt(var(fev)), Mean_of_asthma = mean(asthma), Sd_of_asthma = sqrt(var(asthma)))
df %>% group_by(smoke_gas_exposure) %>% summarise(Mean_of_FEV = mean(fev), Sd_of_FEV = sqrt(var(fev)), Mean_of_asthma = mean(asthma), Sd_of_asthma = sqrt(var(asthma)))
dim(df)
head(df)
tail(df)
summary(df$bmi)
boxplot(df$bmi)
summary(df$fev)
boxplot(df$fev)
df %>% group_by(smoke_gas_exposure) %>% summarise(count = n())
summary(df$pm25_mass)
boxplot(df$pm25_mass)
df %>% ggplot(aes(x = bmi, y = fev)) + geom_point() + geom_smooth(method='lm', formula= y~x) + ggtitle("Scatterplot of BMI vs. FEV") + xlab("BMI") + ylab("Forced expiratory volume in 1 second (ml)") + facet_wrap(df$townname)
df %>% ggplot(aes(x=fev,fill = obesity_level)) + geom_histogram() + scale_fill_manual(values = c("yellow", "red", "blue", "#78BC61")) + theme_minimal() + labs(title = "Stacked histogram of FEV by BMI category")
df %>% ggplot(aes(x=fev,fill = smoke_gas_exposure)) + geom_histogram() + scale_fill_manual(values = c("yellow", "red", "blue", "#78BC61")) + theme_minimal() + labs(title = "Stacked histogram of FEV by smoke/gas exposure")
df %>% ggplot() + aes(x=obesity_level, fill=smoke_gas_exposure) + geom_bar(position = "dodge") + scale_fill_brewer(palette = "PuOr") + theme_minimal() + labs(title="Barchart of BMI by smoke/gas exposure", x="BMI", y="count")
df %>% ggplot() + aes(x=obesity_level, y=fev) + stat_summary(fun.data = "mean_sdl", geom = "errorbar") + stat_summary(fun.data = "mean_sdl")
df %>% ggplot() + aes(x=smoke_gas_exposure, y=fev) + stat_summary(fun.data = "mean_sdl", geom = "errorbar") + stat_summary(fun.data = "mean_sdl")
pm_pal <- colorNumeric(c('blue', 'yellow', 'red'), domain = df$pm25_mass, na.color = NA)
df %>% drop_na() %>% leaflet() %>% addProviderTiles('OpenStreetMap') %>% addCircles(lat = ~lat, lng = ~lon, color=~pm_pal(pm25_mass), label=~round(pm25_mass,2), opacity = 1, fillOpacity = 1) %>% addLegend('bottomleft', pal = pm_pal, values=df$pm25_mass, title="pm2.5 concentration", opacity=1)
df %>% ggplot(aes(x = fev, y = pm25_mass)) + geom_point() + geom_smooth(method='lm', formula= y~x) + ggtitle("Scatterplot of FEV vs. PM2.5 concentration") + xlab("forced expiratory volume") + ylab("pm2.5 concentration")
df %>% ggplot(aes(x=as.factor(pm25_mass), y=fev)) + geom_boxplot() + ggtitle("Boxplot of FEV with different PM2.5 concentration") + xlab("pm2.5 concentration") + ylab("forced expiratory volume")
ggplot(df, aes(x=weight, y=fev)) + geom_point() + geom_smooth(method="lm") + geom_smooth(method = "gam", col=2)
library(mgcv)
lm_mod <- lm(fev ~ weight+agepft+male+as.factor(race), data=df)
summary(lm_mod)
gam_mod <- gam(fev ~ s(weight, bs="cr", k=20)+agepft+male+as.factor(race), data=df)
summary(gam_mod)
ggplot(df, aes(x=weight, y=fev)) + geom_point() + geom_smooth(method="lm") + geom_smooth(method = "gam", col=20)
library(mgcv)
lm_mod <- lm(fev ~ weight+agepft+male+as.factor(race), data=df)
summary(lm_mod)
ggplot(df, aes(x=weight, y=fev)) + geom_point() + geom_smooth(method="lm") + geom_smooth(method = "gam", col=3)
library(mgcv)
lm_mod <- lm(fev ~ weight+agepft+male+as.factor(race), data=df)
summary(lm_mod)
ggplot(df, aes(x=weight, y=fev)) + geom_point() + geom_smooth(method="lm") + geom_smooth(method = "gam", col=4)
library(mgcv)
lm_mod <- lm(fev ~ weight+agepft+male+as.factor(race), data=df)
summary(lm_mod)
ggplot(df, aes(x=weight, y=fev)) + geom_point() + geom_smooth(method="lm") + geom_smooth(method = "gam", col=2)
library(mgcv)
lm_mod <- lm(fev ~ weight+agepft+male+as.factor(race), data=df)
summary(lm_mod)
ggplot(df, aes(x=weight, y=fev)) + geom_point() + geom_smooth(method="lm") + geom_smooth(method = "gam", col=2, fomula = fev ~ s(weight, bs="cr", k=20))
library(mgcv)
lm_mod <- lm(fev ~ weight+agepft+male+as.factor(race), data=df)
summary(lm_mod)
ggplot(df, aes(x=weight, y=fev)) + geom_point() + geom_smooth(method="lm") + geom_smooth(method = "gam", fomula = fev ~ s(weight, bs="cr", k=20))
library(mgcv)
lm_mod <- lm(fev ~ weight+agepft+male+as.factor(race), data=df)
summary(lm_mod)
ggplot(df, aes(x=weight, y=fev)) + geom_point() + geom_smooth(method="lm") + geom_smooth(method = "gam", col=2)
library(mgcv)
lm_mod <- lm(fev ~ weight+agepft+male+as.factor(race), data=df)
summary(lm_mod)
ggplot(df, aes(x=weight, y=fev)) + geom_point() + geom_smooth(method="lm") + geom_smooth(method = "gam", col=2, fomula = fev ~ s(weight, bs="cr", k=20))
library(mgcv)
lm_mod <- lm(fev ~ weight+agepft+male+as.factor(race), data=df)
summary(lm_mod)
ggplot(df, aes(x=weight, y=fev)) + geom_point() + geom_smooth(method="lm") + geom_smooth(method = "gam", col=2, fomula = fev ~ s(weight, bs="cr", k=20))
library(mgcv)
lm_mod <- lm(fev ~ weight+agepft+male+as.factor(race), data=df)
summary(lm_mod)
ggplot(df, aes(x=weight, y=fev)) + geom_point() + geom_smooth(method="lm") + geom_smooth(method = "gam", col=2, fomula = fev ~ s(weight, bs="cr", k=20)+agepft+male+as.factor(race))
library(mgcv)
lm_mod <- lm(fev ~ weight+agepft+male+as.factor(race), data=df)
summary(lm_mod)
ggplot(df, aes(x=weight, y=fev)) + geom_point() + geom_smooth(method="lm", formula = fev ~ weight+agepft+male+as.factor(race)) + geom_smooth(method = "gam", col=2, fomula = fev ~ s(weight, bs="cr", k=20)+agepft+male+as.factor(race))
library(mgcv)
lm_mod <- lm(fev ~ weight+agepft+male+as.factor(race), data=df)
summary(lm_mod)
ggplot(df, aes(x=weight, y=fev)) + geom_point() + geom_smooth(method="lm") + geom_smooth(method = "gam", col=2, fomula = fev ~ s(weight, bs="cr", k=20)+agepft+male+as.factor(race))
library(mgcv)
lm_mod <- lm(fev ~ weight+agepft+male+as.factor(race), data=df)
summary(lm_mod)
ggplot(df, aes(x=weight, y=fev)) + geom_point() + geom_smooth(method="lm") + geom_smooth(method = "gam", col=2, fomula = fev ~ s(weight, bs="cr", k=20))
library(mgcv)
lm_mod <- lm(fev ~ weight+agepft+male+as.factor(race), data=df)
summary(lm_mod)
ggplot(df, aes(x=weight, y=fev)) + geom_point() + geom_smooth(method="lm") + geom_smooth(method = "gam", col=2, formula = fev ~ s(weight, bs="cr", k=20))
library(mgcv)
lm_mod <- lm(fev ~ weight+agepft+male+as.factor(race), data=df)
summary(lm_mod)
ggplot(df, aes(x=weight, y=fev)) + geom_point() + geom_smooth(method="lm") + geom_smooth(method = "gam", col=2, formula = df$fev ~ s(df$weight, bs="cr", k=20))
library(mgcv)
lm_mod <- lm(fev ~ weight+agepft+male+as.factor(race), data=df)
summary(lm_mod)
ggplot(df, aes(x=weight, y=fev)) + geom_point() + geom_smooth(method="lm") + geom_smooth(method = "gam", col=2, formula = y ~ s(x, bs="cr", k=20))
library(mgcv)
lm_mod <- lm(fev ~ weight+agepft+male+as.factor(race), data=df)
summary(lm_mod)
ggplot(df, aes(x=weight, y=fev)) + geom_point() + geom_smooth(method="lm") + geom_smooth(method = "gam", col=2, formula = y ~ s(x, bs="cr", k=30))
library(mgcv)
lm_mod <- lm(fev ~ weight+agepft+male+as.factor(race), data=df)
summary(lm_mod)
ggplot(df, aes(x=weight, y=fev)) + geom_point() + geom_smooth(method="lm") + geom_smooth(method = "gam", col=2, formula = y ~ s(x, bs="cr", k=20))
library(mgcv)
lm_mod <- lm(fev ~ weight+agepft+male+as.factor(race), data=df)
summary(lm_mod)
#install.packages(c("data.table","leaflet", "rdrop2"))
library(data.table)
library(leaflet)
library(tidyverse)
library(rdrop2)
library(GGally)
library(scales)
individual <- read.csv("chs_individual.csv")
regional <- read.csv("chs_regional_geo.csv")
df <- merge.data.frame(individual, regional, "townname")
df <- df %>% group_by(male, hispanic) %>%
mutate_all(list(~ifelse(is.na(.), mean(., na.rm = TRUE),.)))
df <- df %>%
mutate(townname=as.factor(townname)) %>%
mutate(asthma=round(asthma)) %>%
mutate(father_asthma=round(father_asthma)) %>%
mutate(mother_asthma=round(mother_asthma)) %>%
mutate(wheeze=round(wheeze)) %>%
mutate(hayfever=round(hayfever)) %>%
mutate(allergy=round(allergy)) %>%
mutate(educ_parent=round(educ_parent)) %>%
mutate(smoke=round(smoke)) %>%
mutate(gasstove=round(gasstove)) %>%
mutate(obesity_level=case_when(
bmi < 14 ~ "underweight",
14 <= bmi & bmi < 22 ~ "normal",
22 <= bmi & bmi <= 24 ~ "overweight",
bmi > 24 ~ "obese"))
df %>% group_by(obesity_level) %>% summarise(min_BMI = min(bmi), max_BMI = max(bmi), count = n())
df <- df %>% mutate(smoke_gas_exposure = as.factor(interaction(smoke, gasstove)))
df %>% group_by(townname) %>% summarise(Mean_of_FEV = mean(fev), Sd_of_FEV = sqrt(var(fev)), Mean_of_asthma = mean(asthma), Sd_of_asthma = sqrt(var(asthma)))
df %>% group_by(male) %>% summarise(Mean_of_FEV = mean(fev), Sd_of_FEV = sqrt(var(fev)), Mean_of_asthma = mean(asthma), Sd_of_asthma = sqrt(var(asthma)))
df %>% group_by(obesity_level) %>% summarise(Mean_of_FEV = mean(fev), Sd_of_FEV = sqrt(var(fev)), Mean_of_asthma = mean(asthma), Sd_of_asthma = sqrt(var(asthma)))
df %>% group_by(smoke_gas_exposure) %>% summarise(Mean_of_FEV = mean(fev), Sd_of_FEV = sqrt(var(fev)), Mean_of_asthma = mean(asthma), Sd_of_asthma = sqrt(var(asthma)))
dim(df)
head(df)
tail(df)
summary(df$bmi)
boxplot(df$bmi)
summary(df$fev)
boxplot(df$fev)
df %>% group_by(smoke_gas_exposure) %>% summarise(count = n())
summary(df$pm25_mass)
boxplot(df$pm25_mass)
df %>% ggplot(aes(x = bmi, y = fev)) + geom_point() + geom_smooth(method='lm', formula= y~x) + ggtitle("Scatterplot of BMI vs. FEV") + xlab("BMI") + ylab("Forced expiratory volume in 1 second (ml)") + facet_wrap(df$townname)
df %>% ggplot(aes(x=fev,fill = obesity_level)) + geom_histogram() + scale_fill_manual(values = c("yellow", "red", "blue", "#78BC61")) + theme_minimal() + labs(title = "Stacked histogram of FEV by BMI category")
df %>% ggplot(aes(x=fev,fill = smoke_gas_exposure)) + geom_histogram() + scale_fill_manual(values = c("yellow", "red", "blue", "#78BC61")) + theme_minimal() + labs(title = "Stacked histogram of FEV by smoke/gas exposure")
df %>% ggplot() + aes(x=obesity_level, fill=smoke_gas_exposure) + geom_bar(position = "dodge") + scale_fill_brewer(palette = "PuOr") + theme_minimal() + labs(title="Barchart of BMI by smoke/gas exposure", x="BMI", y="count")
df %>% ggplot() + aes(x=obesity_level, y=fev) + stat_summary(fun.data = "mean_sdl", geom = "errorbar") + stat_summary(fun.data = "mean_sdl")
df %>% ggplot() + aes(x=smoke_gas_exposure, y=fev) + stat_summary(fun.data = "mean_sdl", geom = "errorbar") + stat_summary(fun.data = "mean_sdl")
pm_pal <- colorNumeric(c('blue', 'yellow', 'red'), domain = df$pm25_mass, na.color = NA)
df %>% drop_na() %>% leaflet() %>% addProviderTiles('OpenStreetMap') %>% addCircles(lat = ~lat, lng = ~lon, color=~pm_pal(pm25_mass), label=~round(pm25_mass,2), opacity = 1, fillOpacity = 1) %>% addLegend('bottomleft', pal = pm_pal, values=df$pm25_mass, title="pm2.5 concentration", opacity=1)
df %>% ggplot(aes(x = fev, y = pm25_mass)) + geom_point() + geom_smooth(method='lm', formula= y~x) + ggtitle("Scatterplot of FEV vs. PM2.5 concentration") + xlab("forced expiratory volume") + ylab("pm2.5 concentration")
df %>% ggplot(aes(x=as.factor(pm25_mass), y=fev)) + geom_boxplot() + ggtitle("Boxplot of FEV with different PM2.5 concentration") + xlab("pm2.5 concentration") + ylab("forced expiratory volume")
ggplot(df, aes(x=weight, y=fev)) + geom_point() + geom_smooth(method="lm") + geom_smooth(method = "gam", col=2, formula = y ~ s(x, bs="cr", k=20))
library(mgcv)
lm_mod <- lm(fev ~ weight+agepft+male+as.factor(race), data=df)
summary(lm_mod)
gam_mod <- gam(fev ~ s(weight, bs="cr", k=20)+agepft+male+as.factor(race), data=df)
summary(gam_mod)
library(mgcv)
lm_mod <- lm(fev ~ weight+agepft+as.factor(male)+as.factor(race), data=df)
summary(lm_mod)
gam_mod <- gam(fev ~ s(weight, bs="cr", k=20)+agepft+as.factor(male)+as.factor(race), data=df)
summary(gam_mod)
